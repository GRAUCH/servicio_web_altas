function newCalendar(){var initialLocaleCode="es",calendarEl=document.getElementById("calendar"),pais=$("#pais_id").val(),duracion="00:"+$("#slots").val();return calendar=new FullCalendar.Calendar(calendarEl,{plugins:["interaction","dayGrid","timeGrid","list"],header:{left:"addEventButton,           prev,next",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},defaultView:"timeGridWeek",defaultDate:new Date,customButtons:{addEventButton:{text:"Agregar Cita",click:function(){addApoimentRemotely()}}},locale:initialLocaleCode,buttonIcons:!1,weekNumbers:!0,eventBackgroundColor:"#4CAF50",minTime:$("#iniDate").val().split(" ")[1],maxTime:$("#finDate").val().split(" ")[1],navLinks:!0,editable:!1,eventLimit:!0,weekends:!1,slotDuration:duracion,eventRender:function(info){new Tooltip(info.el,{title:info.event.extendedProps.description,placement:"top",trigger:"hover",container:"body"})},events:"/ServicioWebAltas/citas/list?pais="+pais}),calendar.render(),calendar}function newCalendarIE(){var initialLocaleCode="es",calendarEl=document.getElementById("calendar"),duracion=($("#pais_id").val(),"00:"+$("#slots").val());return calendar=new FullCalendar.Calendar(calendarEl,{plugins:["interaction","dayGrid","timeGrid","list"],header:{left:"addEventButton refreshButton prevButton",center:"title",right:"nextButton monthButton,weekButton,agendaButton"},defaultView:"timeGridWeek",defaultDate:new Date,customButtons:{addEventButton:{text:"Agregar Cita",click:function(){addApoimentRemotely()}},refreshButton:{text:"Refrescar",click:function(){var data=getPais(calendar);updateEvents(calendar,data)}},prevButton:{text:"<",click:function(){var data=getPrev(calendar);updateEvents(calendar,data),calendar.prev()}},nextButton:{text:">",click:function(){var data=getNext(calendar);updateEvents(calendar,data),calendar.next()}},monthButton:{text:"Mes",click:function(){calendar.changeView("dayGridMonth");var data=getPais(calendar);updateEvents(calendar,data)}},weekButton:{text:"Semana",click:function(){calendar.changeView("timeGridWeek");var data=getPais(calendar);updateEvents(calendar,data)}},agendaButton:{text:"Agenda",click:function(){calendar.changeView("listMonth");var data=getPais(calendar);updateEvents(calendar,data)}}},locale:initialLocaleCode,buttonIcons:!1,weekNumbers:!0,eventBackgroundColor:"#4CAF50",minTime:$("#iniDate").val().split(" ")[1],maxTime:$("#finDate").val().split(" ")[1],navLinks:!0,editable:!1,eventLimit:!0,weekends:!1,slotDuration:duracion,eventRender:function(info){new Tooltip(info.el,{title:info.event.extendedProps.description,placement:"top",trigger:"hover",container:"body"})}}),calendar.render(),calendar}function addApoimentRemotely(){$("#myModal").modal("show")}function getPais(calendar){var view=calendar.view,start=view.activeStart,end=view.activeEnd,data=new FormData,pais=$("#pais_id").val();return data.append("pais",pais),data.append("start",start.toDateString()),data.append("end",end.toDateString()),data}function getPrev(calendar){var view=calendar.view,type=view.type,button="prev",start=view.activeStart,end=view.activeEnd,data=new FormData,pais=$("#pais_id").val();return data.append("pais",pais),data.append("start",start.toDateString()),data.append("end",end.toDateString()),data.append("type",type),data.append("button",button),data}function getNext(calendar){var view=calendar.view,type=view.type,button="next",start=view.activeStart,end=view.activeEnd,data=new FormData,pais=$("#pais_id").val();return data.append("pais",pais),data.append("start",start.toDateString()),data.append("end",end.toDateString()),data.append("type",type),data.append("button",button),data}function updateEvents(calendar,data){$.ajax({data:data,contentType:!1,processData:!1,dataType:"html",url:$("#updateCitas").val(),method:"POST",success:function(json){var returnedData=JSON.parse(json);calendar.removeAllEvents(),calendar.addEventSource(returnedData)},error:function(response){response.responseText&&alert(response.responseText)}})}function sendData(calendar){var data=getData();$.ajax({data:data,contentType:!1,processData:!1,dataType:"html",url:$("#nuevacita").val(),method:"POST",success:function(json){var returnedData=JSON.parse(json);calendar.addEvent({company:returnedData[0].company,config:returnedData[0].config,title:returnedData[0].title,description:returnedData[0].description,url:returnedData[0].url,start:returnedData[0].start,end:returnedData[0].end,allDay:!1}),$("#myModal").on("hidden.bs.modal",function(){$(this).find("input").val("").end()}),$("#myModal").modal("hide")},error:function(response){response.responseText&&alert(response.responseText)}})}function getTimes(){for(var times=[],slot=parseInt($("#slots").val()),iniDate=$("#iniDate").val().split(" ")[1],finDate=$("#finDate").val().split(" ")[1],division=60/slot,horaIni=parseInt(iniDate.split(":")[0]),horaFin=parseInt(finDate.split(":")[0]),j=horaIni;horaFin>j;j++)for(var i=0;division>i;i++)times.push(j+":"+slot*i);return times}function printErrorMessage(errorMessage){errorMessage.forEach(function(error){$("#calen").append("<span>"+error+"</span>")})}function getData(){var data=new FormData;return data.append("company",$("#inputCompany").val()),data.append("config",$("#inputConfig").val()),data.append("title",$("#inputTitle").val()),data.append("description",$("#inputDescription").val()),data.append("numeroExpediente",$("#inputNumeroExpediente").val()),data.append("startTime",$("#inputStartTime").val()),data.append("endTime",$("#inputEndTime").val()),data}function getCountry(pais){var data=new FormData;return data.append("pais_id",pais.value),data}var calendar;document.addEventListener("DOMContentLoaded",function(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");if(msie>0||navigator.userAgent.match(/Trident.*rv\:11\./)){var x=document.getElementById("refrescar");if(x.style.display="none",calendar=newCalendarIE(),null!=calendar){var data=getPais(calendar);updateEvents(calendar,data)}}else calendar=newCalendar()}),jQuery(document).ready(function(){"use strict";jQuery("#filter-date, #search-from-date, #search-to-date").datetimepicker()}),$(function(){var times=getTimes();$(".datepicker").datetimepicker({format:"d/m/Y H:i",allowTimes:times}),$.datetimepicker.setLocale("es")});