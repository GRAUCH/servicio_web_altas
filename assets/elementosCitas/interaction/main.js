!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@fullcalendar/core")):"function"==typeof define&&define.amd?define(["exports","@fullcalendar/core"],factory):(global=global||self,factory(global.FullCalendarInteraction={},global.FullCalendar))}(this,function(exports,core){"use strict";function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}function isPrimaryMouseButton(ev){return 0===ev.button&&!ev.ctrlKey}function startIgnoringMouse(){ignoreMouseDepth++,setTimeout(function(){ignoreMouseDepth--},core.config.touchMouseIgnoreWait)}function listenerCreated(){listenerCnt++||window.addEventListener("touchmove",onWindowTouchMove,{passive:!1})}function listenerDestroyed(){--listenerCnt||window.removeEventListener("touchmove",onWindowTouchMove,{passive:!1})}function onWindowTouchMove(ev){isWindowTouchMoveCancelled&&ev.preventDefault()}function isIgnoredClipping(node){var tagName=node.tagName;return"HTML"===tagName||"BODY"===tagName}function isHitsEqual(hit0,hit1){return hit0||hit1?Boolean(hit0)!==Boolean(hit1)?!1:core.isDateSpansEqual(hit0.dateSpan,hit1.dateSpan):!0}function getComponentTouchDelay(component){var options=component.context.options,delay=options.selectLongPressDelay;return null==delay&&(delay=options.longPressDelay),delay}function joinHitsIntoSelection(hit0,hit1,dateSelectionTransformers){var dateSpan0=hit0.dateSpan,dateSpan1=hit1.dateSpan,ms=[dateSpan0.range.start,dateSpan0.range.end,dateSpan1.range.start,dateSpan1.range.end];ms.sort(core.compareNumbers);for(var props={},_i=0,dateSelectionTransformers_1=dateSelectionTransformers;_i<dateSelectionTransformers_1.length;_i++){var transformer=dateSelectionTransformers_1[_i],res=transformer(hit0,hit1);if(res===!1)return null;res&&__assign(props,res)}return props.range={start:ms[0],end:ms[3]},props.allDay=dateSpan0.allDay,props}function computeEventMutation(hit0,hit1,massagers){var dateSpan0=hit0.dateSpan,dateSpan1=hit1.dateSpan,date0=dateSpan0.range.start,date1=dateSpan1.range.start,standardProps={};dateSpan0.allDay!==dateSpan1.allDay&&(standardProps.allDay=dateSpan1.allDay,standardProps.hasEnd=hit1.component.context.options.allDayMaintainDuration,dateSpan1.allDay&&(date0=core.startOfDay(date0)));var delta=core.diffDates(date0,date1,hit0.component.context.dateEnv,hit0.component===hit1.component?hit0.component.largeUnit:null);delta.milliseconds&&(standardProps.allDay=!1);for(var mutation={datesDelta:delta,standardProps:standardProps},_i=0,massagers_1=massagers;_i<massagers_1.length;_i++){var massager=massagers_1[_i];massager(mutation,hit0,hit1)}return mutation}function getComponentTouchDelay$1(component){var options=component.context.options,delay=options.eventLongPressDelay;return null==delay&&(delay=options.longPressDelay),delay}function computeMutation(hit0,hit1,isFromStart,instanceRange,transforms){for(var dateEnv=hit0.component.context.dateEnv,date0=hit0.dateSpan.range.start,date1=hit1.dateSpan.range.start,delta=core.diffDates(date0,date1,dateEnv,hit0.component.largeUnit),props={},_i=0,transforms_1=transforms;_i<transforms_1.length;_i++){var transform=transforms_1[_i],res=transform(hit0,hit1);if(res===!1)return null;res&&__assign(props,res)}if(isFromStart){if(dateEnv.add(instanceRange.start,delta)<instanceRange.end)return props.startDelta=delta,props}else if(dateEnv.add(instanceRange.end,delta)>instanceRange.start)return props.endDelta=delta,props;return null}function computeEventForDateSpan(dateSpan,dragMeta,calendar){for(var defProps=__assign({},dragMeta.leftoverProps),_i=0,_a=calendar.pluginSystem.hooks.externalDefTransforms;_i<_a.length;_i++){var transform=_a[_i];__assign(defProps,transform(dateSpan,dragMeta))}var def=core.parseEventDef(defProps,dragMeta.sourceId,dateSpan.allDay,calendar.opt("forceEventDuration")||Boolean(dragMeta.duration),calendar),start=dateSpan.range.start;dateSpan.allDay&&dragMeta.startTime&&(start=calendar.dateEnv.add(start,dragMeta.startTime));var end=dragMeta.duration?calendar.dateEnv.add(start,dragMeta.duration):calendar.getDefaultEventEnd(dateSpan.allDay,start),instance=core.createEventInstance(def.defId,{start:start,end:end});return{def:def,instance:instance}}function getDragMetaFromEl(el){var str=getEmbeddedElData(el,"event"),obj=str?JSON.parse(str):{create:!1};return core.parseDragMeta(obj)}function getEmbeddedElData(el,name){var prefix=core.config.dataAttrPrefix,prefixedName=(prefix?prefix+"-":"")+name;return el.getAttribute("data-"+prefixedName)||""}var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},__assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;n>i;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__assign.apply(this,arguments)};core.config.touchMouseIgnoreWait=500;var ignoreMouseDepth=0,listenerCnt=0,isWindowTouchMoveCancelled=!1,PointerDragging=function(){function PointerDragging(containerEl){var _this=this;this.subjectEl=null,this.downEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=function(ev){if(!_this.shouldIgnoreMouse()&&isPrimaryMouseButton(ev)&&_this.tryStart(ev)){var pev=_this.createEventFromMouse(ev,!0);_this.emitter.trigger("pointerdown",pev),_this.initScrollWatch(pev),_this.shouldIgnoreMove||document.addEventListener("mousemove",_this.handleMouseMove),document.addEventListener("mouseup",_this.handleMouseUp)}},this.handleMouseMove=function(ev){var pev=_this.createEventFromMouse(ev);_this.recordCoords(pev),_this.emitter.trigger("pointermove",pev)},this.handleMouseUp=function(ev){document.removeEventListener("mousemove",_this.handleMouseMove),document.removeEventListener("mouseup",_this.handleMouseUp),_this.emitter.trigger("pointerup",_this.createEventFromMouse(ev)),_this.cleanup()},this.handleTouchStart=function(ev){if(_this.tryStart(ev)){_this.isTouchDragging=!0;var pev=_this.createEventFromTouch(ev,!0);_this.emitter.trigger("pointerdown",pev),_this.initScrollWatch(pev);var target=ev.target;_this.shouldIgnoreMove||target.addEventListener("touchmove",_this.handleTouchMove),target.addEventListener("touchend",_this.handleTouchEnd),target.addEventListener("touchcancel",_this.handleTouchEnd),window.addEventListener("scroll",_this.handleTouchScroll,!0)}},this.handleTouchMove=function(ev){var pev=_this.createEventFromTouch(ev);_this.recordCoords(pev),_this.emitter.trigger("pointermove",pev)},this.handleTouchEnd=function(ev){if(_this.isDragging){var target=ev.target;target.removeEventListener("touchmove",_this.handleTouchMove),target.removeEventListener("touchend",_this.handleTouchEnd),target.removeEventListener("touchcancel",_this.handleTouchEnd),window.removeEventListener("scroll",_this.handleTouchScroll,!0),_this.emitter.trigger("pointerup",_this.createEventFromTouch(ev)),_this.cleanup(),_this.isTouchDragging=!1,startIgnoringMouse()}},this.handleTouchScroll=function(){_this.wasTouchScroll=!0},this.handleScroll=function(ev){if(!_this.shouldIgnoreMove){var pageX=window.pageXOffset-_this.prevScrollX+_this.prevPageX,pageY=window.pageYOffset-_this.prevScrollY+_this.prevPageY;_this.emitter.trigger("pointermove",{origEvent:ev,isTouch:_this.isTouchDragging,subjectEl:_this.subjectEl,pageX:pageX,pageY:pageY,deltaX:pageX-_this.origPageX,deltaY:pageY-_this.origPageY})}},this.containerEl=containerEl,this.emitter=new core.EmitterMixin,containerEl.addEventListener("mousedown",this.handleMouseDown),containerEl.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),listenerCreated()}return PointerDragging.prototype.destroy=function(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),listenerDestroyed()},PointerDragging.prototype.tryStart=function(ev){var subjectEl=this.querySubjectEl(ev),downEl=ev.target;return!subjectEl||this.handleSelector&&!core.elementClosest(downEl,this.handleSelector)?!1:(this.subjectEl=subjectEl,this.downEl=downEl,this.isDragging=!0,this.wasTouchScroll=!1,!0)},PointerDragging.prototype.cleanup=function(){isWindowTouchMoveCancelled=!1,this.isDragging=!1,this.subjectEl=null,this.downEl=null,this.destroyScrollWatch()},PointerDragging.prototype.querySubjectEl=function(ev){return this.selector?core.elementClosest(ev.target,this.selector):this.containerEl},PointerDragging.prototype.shouldIgnoreMouse=function(){return ignoreMouseDepth||this.isTouchDragging},PointerDragging.prototype.cancelTouchScroll=function(){this.isDragging&&(isWindowTouchMoveCancelled=!0)},PointerDragging.prototype.initScrollWatch=function(ev){this.shouldWatchScroll&&(this.recordCoords(ev),window.addEventListener("scroll",this.handleScroll,!0))},PointerDragging.prototype.recordCoords=function(ev){this.shouldWatchScroll&&(this.prevPageX=ev.pageX,this.prevPageY=ev.pageY,this.prevScrollX=window.pageXOffset,this.prevScrollY=window.pageYOffset)},PointerDragging.prototype.destroyScrollWatch=function(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)},PointerDragging.prototype.createEventFromMouse=function(ev,isFirst){var deltaX=0,deltaY=0;return isFirst?(this.origPageX=ev.pageX,this.origPageY=ev.pageY):(deltaX=ev.pageX-this.origPageX,deltaY=ev.pageY-this.origPageY),{origEvent:ev,isTouch:!1,subjectEl:this.subjectEl,pageX:ev.pageX,pageY:ev.pageY,deltaX:deltaX,deltaY:deltaY}},PointerDragging.prototype.createEventFromTouch=function(ev,isFirst){var pageX,pageY,touches=ev.touches,deltaX=0,deltaY=0;return touches&&touches.length?(pageX=touches[0].pageX,pageY=touches[0].pageY):(pageX=ev.pageX,pageY=ev.pageY),isFirst?(this.origPageX=pageX,this.origPageY=pageY):(deltaX=pageX-this.origPageX,deltaY=pageY-this.origPageY),{origEvent:ev,isTouch:!0,subjectEl:this.subjectEl,pageX:pageX,pageY:pageY,deltaX:deltaX,deltaY:deltaY}},PointerDragging}(),ElementMirror=function(){function ElementMirror(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}return ElementMirror.prototype.start=function(sourceEl,pageX,pageY){this.sourceEl=sourceEl,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=pageX-window.pageXOffset,this.origScreenY=pageY-window.pageYOffset,this.deltaX=0,this.deltaY=0,this.updateElPosition()},ElementMirror.prototype.handleMove=function(pageX,pageY){this.deltaX=pageX-window.pageXOffset-this.origScreenX,this.deltaY=pageY-window.pageYOffset-this.origScreenY,this.updateElPosition()},ElementMirror.prototype.setIsVisible=function(bool){bool?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=bool,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=bool)},ElementMirror.prototype.stop=function(needsRevertAnimation,callback){var _this=this,done=function(){_this.cleanup(),callback()};needsRevertAnimation&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(done,this.revertDuration):setTimeout(done,0)},ElementMirror.prototype.doRevertAnimation=function(callback,revertDuration){var mirrorEl=this.mirrorEl,finalSourceElRect=this.sourceEl.getBoundingClientRect();mirrorEl.style.transition="top "+revertDuration+"ms,left "+revertDuration+"ms",core.applyStyle(mirrorEl,{left:finalSourceElRect.left,top:finalSourceElRect.top}),core.whenTransitionDone(mirrorEl,function(){mirrorEl.style.transition="",callback()})},ElementMirror.prototype.cleanup=function(){this.mirrorEl&&(core.removeElement(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null},ElementMirror.prototype.updateElPosition=function(){this.sourceEl&&this.isVisible&&core.applyStyle(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})},ElementMirror.prototype.getMirrorEl=function(){var sourceElRect=this.sourceElRect,mirrorEl=this.mirrorEl;return mirrorEl||(mirrorEl=this.mirrorEl=this.sourceEl.cloneNode(!0),mirrorEl.classList.add("fc-unselectable"),mirrorEl.classList.add("fc-dragging"),core.applyStyle(mirrorEl,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:sourceElRect.right-sourceElRect.left,height:sourceElRect.bottom-sourceElRect.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(mirrorEl)),mirrorEl},ElementMirror}(),ScrollGeomCache=function(_super){function ScrollGeomCache(scrollController,doesListening){var _this=_super.call(this)||this;return _this.handleScroll=function(){_this.scrollTop=_this.scrollController.getScrollTop(),_this.scrollLeft=_this.scrollController.getScrollLeft(),_this.handleScrollChange()},_this.scrollController=scrollController,_this.doesListening=doesListening,_this.scrollTop=_this.origScrollTop=scrollController.getScrollTop(),_this.scrollLeft=_this.origScrollLeft=scrollController.getScrollLeft(),_this.scrollWidth=scrollController.getScrollWidth(),_this.scrollHeight=scrollController.getScrollHeight(),_this.clientWidth=scrollController.getClientWidth(),_this.clientHeight=scrollController.getClientHeight(),_this.clientRect=_this.computeClientRect(),_this.doesListening&&_this.getEventTarget().addEventListener("scroll",_this.handleScroll),_this}return __extends(ScrollGeomCache,_super),ScrollGeomCache.prototype.destroy=function(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)},ScrollGeomCache.prototype.getScrollTop=function(){return this.scrollTop},ScrollGeomCache.prototype.getScrollLeft=function(){return this.scrollLeft},ScrollGeomCache.prototype.setScrollTop=function(top){this.scrollController.setScrollTop(top),this.doesListening||(this.scrollTop=Math.max(Math.min(top,this.getMaxScrollTop()),0),this.handleScrollChange())},ScrollGeomCache.prototype.setScrollLeft=function(top){this.scrollController.setScrollLeft(top),this.doesListening||(this.scrollLeft=Math.max(Math.min(top,this.getMaxScrollLeft()),0),this.handleScrollChange())},ScrollGeomCache.prototype.getClientWidth=function(){return this.clientWidth},ScrollGeomCache.prototype.getClientHeight=function(){return this.clientHeight},ScrollGeomCache.prototype.getScrollWidth=function(){return this.scrollWidth},ScrollGeomCache.prototype.getScrollHeight=function(){return this.scrollHeight},ScrollGeomCache.prototype.handleScrollChange=function(){},ScrollGeomCache}(core.ScrollController),ElementScrollGeomCache=function(_super){function ElementScrollGeomCache(el,doesListening){return _super.call(this,new core.ElementScrollController(el),doesListening)||this}return __extends(ElementScrollGeomCache,_super),ElementScrollGeomCache.prototype.getEventTarget=function(){return this.scrollController.el},ElementScrollGeomCache.prototype.computeClientRect=function(){return core.computeInnerRect(this.scrollController.el)},ElementScrollGeomCache}(ScrollGeomCache),WindowScrollGeomCache=function(_super){function WindowScrollGeomCache(doesListening){return _super.call(this,new core.WindowScrollController,doesListening)||this}return __extends(WindowScrollGeomCache,_super),WindowScrollGeomCache.prototype.getEventTarget=function(){return window},WindowScrollGeomCache.prototype.computeClientRect=function(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}},WindowScrollGeomCache.prototype.handleScrollChange=function(){this.clientRect=this.computeClientRect()},WindowScrollGeomCache}(ScrollGeomCache),getTime="function"==typeof performance?performance.now:Date.now,AutoScroller=function(){function AutoScroller(){var _this=this;this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=function(){if(_this.isAnimating){var edge=_this.computeBestEdge(_this.pointerScreenX+window.pageXOffset,_this.pointerScreenY+window.pageYOffset);if(edge){var now=getTime();_this.handleSide(edge,(now-_this.msSinceRequest)/1e3),_this.requestAnimation(now)}else _this.isAnimating=!1}}}return AutoScroller.prototype.start=function(pageX,pageY){this.isEnabled&&(this.scrollCaches=this.buildCaches(),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(pageX,pageY))},AutoScroller.prototype.handleMove=function(pageX,pageY){if(this.isEnabled){var pointerScreenX=pageX-window.pageXOffset,pointerScreenY=pageY-window.pageYOffset,yDelta=null===this.pointerScreenY?0:pointerScreenY-this.pointerScreenY,xDelta=null===this.pointerScreenX?0:pointerScreenX-this.pointerScreenX;0>yDelta?this.everMovedUp=!0:yDelta>0&&(this.everMovedDown=!0),0>xDelta?this.everMovedLeft=!0:xDelta>0&&(this.everMovedRight=!0),this.pointerScreenX=pointerScreenX,this.pointerScreenY=pointerScreenY,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(getTime()))}},AutoScroller.prototype.stop=function(){if(this.isEnabled){this.isAnimating=!1;for(var _i=0,_a=this.scrollCaches;_i<_a.length;_i++){var scrollCache=_a[_i];scrollCache.destroy()}this.scrollCaches=null}},AutoScroller.prototype.requestAnimation=function(now){this.msSinceRequest=now,requestAnimationFrame(this.animate)},AutoScroller.prototype.handleSide=function(edge,seconds){var scrollCache=edge.scrollCache,edgeThreshold=this.edgeThreshold,invDistance=edgeThreshold-edge.distance,velocity=invDistance*invDistance/(edgeThreshold*edgeThreshold)*this.maxVelocity*seconds,sign=1;switch(edge.name){case"left":sign=-1;case"right":scrollCache.setScrollLeft(scrollCache.getScrollLeft()+velocity*sign);break;case"top":sign=-1;case"bottom":scrollCache.setScrollTop(scrollCache.getScrollTop()+velocity*sign)}},AutoScroller.prototype.computeBestEdge=function(left,top){for(var edgeThreshold=this.edgeThreshold,bestSide=null,_i=0,_a=this.scrollCaches;_i<_a.length;_i++){var scrollCache=_a[_i],rect=scrollCache.clientRect,leftDist=left-rect.left,rightDist=rect.right-left,topDist=top-rect.top,bottomDist=rect.bottom-top;leftDist>=0&&rightDist>=0&&topDist>=0&&bottomDist>=0&&(edgeThreshold>=topDist&&this.everMovedUp&&scrollCache.canScrollUp()&&(!bestSide||bestSide.distance>topDist)&&(bestSide={scrollCache:scrollCache,name:"top",distance:topDist}),edgeThreshold>=bottomDist&&this.everMovedDown&&scrollCache.canScrollDown()&&(!bestSide||bestSide.distance>bottomDist)&&(bestSide={scrollCache:scrollCache,name:"bottom",distance:bottomDist}),edgeThreshold>=leftDist&&this.everMovedLeft&&scrollCache.canScrollLeft()&&(!bestSide||bestSide.distance>leftDist)&&(bestSide={scrollCache:scrollCache,name:"left",distance:leftDist}),edgeThreshold>=rightDist&&this.everMovedRight&&scrollCache.canScrollRight()&&(!bestSide||bestSide.distance>rightDist)&&(bestSide={scrollCache:scrollCache,name:"right",distance:rightDist}))}return bestSide},AutoScroller.prototype.buildCaches=function(){return this.queryScrollEls().map(function(el){return el===window?new WindowScrollGeomCache(!1):new ElementScrollGeomCache(el,!1)})},AutoScroller.prototype.queryScrollEls=function(){for(var els=[],_i=0,_a=this.scrollQuery;_i<_a.length;_i++){var query=_a[_i];"object"==typeof query?els.push(query):els.push.apply(els,Array.prototype.slice.call(document.querySelectorAll(query)))}return els},AutoScroller}(),FeaturefulElementDragging=function(_super){function FeaturefulElementDragging(containerEl){var _this=_super.call(this,containerEl)||this;_this.delay=null,_this.minDistance=0,_this.touchScrollAllowed=!0,_this.mirrorNeedsRevert=!1,_this.isInteracting=!1,_this.isDragging=!1,_this.isDelayEnded=!1,_this.isDistanceSurpassed=!1,_this.delayTimeoutId=null,_this.onPointerDown=function(ev){_this.isDragging||(_this.isInteracting=!0,_this.isDelayEnded=!1,_this.isDistanceSurpassed=!1,core.preventSelection(document.body),core.preventContextMenu(document.body),ev.isTouch||ev.origEvent.preventDefault(),_this.emitter.trigger("pointerdown",ev),_this.pointer.shouldIgnoreMove||(_this.mirror.setIsVisible(!1),_this.mirror.start(ev.subjectEl,ev.pageX,ev.pageY),_this.startDelay(ev),_this.minDistance||_this.handleDistanceSurpassed(ev)))},_this.onPointerMove=function(ev){if(_this.isInteracting){if(_this.emitter.trigger("pointermove",ev),!_this.isDistanceSurpassed){var minDistance=_this.minDistance,distanceSq=void 0,deltaX=ev.deltaX,deltaY=ev.deltaY;distanceSq=deltaX*deltaX+deltaY*deltaY,distanceSq>=minDistance*minDistance&&_this.handleDistanceSurpassed(ev)}_this.isDragging&&("scroll"!==ev.origEvent.type&&(_this.mirror.handleMove(ev.pageX,ev.pageY),_this.autoScroller.handleMove(ev.pageX,ev.pageY)),_this.emitter.trigger("dragmove",ev))}},_this.onPointerUp=function(ev){_this.isInteracting&&(_this.isInteracting=!1,core.allowSelection(document.body),core.allowContextMenu(document.body),_this.emitter.trigger("pointerup",ev),_this.isDragging&&(_this.autoScroller.stop(),_this.tryStopDrag(ev)),_this.delayTimeoutId&&(clearTimeout(_this.delayTimeoutId),_this.delayTimeoutId=null))};var pointer=_this.pointer=new PointerDragging(containerEl);return pointer.emitter.on("pointerdown",_this.onPointerDown),pointer.emitter.on("pointermove",_this.onPointerMove),pointer.emitter.on("pointerup",_this.onPointerUp),_this.mirror=new ElementMirror,_this.autoScroller=new AutoScroller,_this}return __extends(FeaturefulElementDragging,_super),FeaturefulElementDragging.prototype.destroy=function(){this.pointer.destroy()},FeaturefulElementDragging.prototype.startDelay=function(ev){var _this=this;"number"==typeof this.delay?this.delayTimeoutId=setTimeout(function(){_this.delayTimeoutId=null,_this.handleDelayEnd(ev)},this.delay):this.handleDelayEnd(ev)},FeaturefulElementDragging.prototype.handleDelayEnd=function(ev){this.isDelayEnded=!0,this.tryStartDrag(ev)},FeaturefulElementDragging.prototype.handleDistanceSurpassed=function(ev){this.isDistanceSurpassed=!0,this.tryStartDrag(ev)},FeaturefulElementDragging.prototype.tryStartDrag=function(ev){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(ev.pageX,ev.pageY),this.emitter.trigger("dragstart",ev),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())},FeaturefulElementDragging.prototype.tryStopDrag=function(ev){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,ev))},FeaturefulElementDragging.prototype.stopDrag=function(ev){this.isDragging=!1,this.emitter.trigger("dragend",ev)},FeaturefulElementDragging.prototype.setIgnoreMove=function(bool){this.pointer.shouldIgnoreMove=bool},FeaturefulElementDragging.prototype.setMirrorIsVisible=function(bool){this.mirror.setIsVisible(bool)},FeaturefulElementDragging.prototype.setMirrorNeedsRevert=function(bool){this.mirrorNeedsRevert=bool},FeaturefulElementDragging.prototype.setAutoScrollEnabled=function(bool){this.autoScroller.isEnabled=bool},FeaturefulElementDragging}(core.ElementDragging),OffsetTracker=function(){function OffsetTracker(el){this.origRect=core.computeRect(el),this.scrollCaches=core.getClippingParents(el).map(function(el){return new ElementScrollGeomCache(el,!0)})}return OffsetTracker.prototype.destroy=function(){for(var _i=0,_a=this.scrollCaches;_i<_a.length;_i++){var scrollCache=_a[_i];scrollCache.destroy()}},OffsetTracker.prototype.computeLeft=function(){for(var left=this.origRect.left,_i=0,_a=this.scrollCaches;_i<_a.length;_i++){var scrollCache=_a[_i];left+=scrollCache.origScrollLeft-scrollCache.getScrollLeft()}return left},OffsetTracker.prototype.computeTop=function(){for(var top=this.origRect.top,_i=0,_a=this.scrollCaches;_i<_a.length;_i++){var scrollCache=_a[_i];top+=scrollCache.origScrollTop-scrollCache.getScrollTop()}return top},OffsetTracker.prototype.isWithinClipping=function(pageX,pageY){for(var point={left:pageX,top:pageY},_i=0,_a=this.scrollCaches;_i<_a.length;_i++){var scrollCache=_a[_i];if(!isIgnoredClipping(scrollCache.getEventTarget())&&!core.pointInsideRect(point,scrollCache.clientRect))return!1}return!0},OffsetTracker}(),HitDragging=function(){function HitDragging(dragging,droppableStore){var _this=this;this.useSubjectCenter=!1,this.requireInitial=!0,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=function(ev){var dragging=_this.dragging;_this.initialHit=null,_this.movingHit=null,_this.finalHit=null,_this.prepareHits(),_this.processFirstCoord(ev),_this.initialHit||!_this.requireInitial?(dragging.setIgnoreMove(!1),_this.emitter.trigger("pointerdown",ev)):dragging.setIgnoreMove(!0)},this.handleDragStart=function(ev){_this.emitter.trigger("dragstart",ev),_this.handleMove(ev,!0)},this.handleDragMove=function(ev){_this.emitter.trigger("dragmove",ev),_this.handleMove(ev)},this.handlePointerUp=function(ev){_this.releaseHits(),_this.emitter.trigger("pointerup",ev)},this.handleDragEnd=function(ev){_this.movingHit&&_this.emitter.trigger("hitupdate",null,!0,ev),_this.finalHit=_this.movingHit,_this.movingHit=null,_this.emitter.trigger("dragend",ev)},this.droppableStore=droppableStore,dragging.emitter.on("pointerdown",this.handlePointerDown),dragging.emitter.on("dragstart",this.handleDragStart),dragging.emitter.on("dragmove",this.handleDragMove),dragging.emitter.on("pointerup",this.handlePointerUp),dragging.emitter.on("dragend",this.handleDragEnd),this.dragging=dragging,this.emitter=new core.EmitterMixin}return HitDragging.prototype.processFirstCoord=function(ev){var subjectRect,origPoint={left:ev.pageX,top:ev.pageY},adjustedPoint=origPoint,subjectEl=ev.subjectEl;subjectEl!==document&&(subjectRect=core.computeRect(subjectEl),adjustedPoint=core.constrainPoint(adjustedPoint,subjectRect));var initialHit=this.initialHit=this.queryHitForOffset(adjustedPoint.left,adjustedPoint.top);if(initialHit){if(this.useSubjectCenter&&subjectRect){var slicedSubjectRect=core.intersectRects(subjectRect,initialHit.rect);slicedSubjectRect&&(adjustedPoint=core.getRectCenter(slicedSubjectRect))}this.coordAdjust=core.diffPoints(adjustedPoint,origPoint)}else this.coordAdjust={left:0,top:0}},HitDragging.prototype.handleMove=function(ev,forceHandle){var hit=this.queryHitForOffset(ev.pageX+this.coordAdjust.left,ev.pageY+this.coordAdjust.top);(forceHandle||!isHitsEqual(this.movingHit,hit))&&(this.movingHit=hit,this.emitter.trigger("hitupdate",hit,!1,ev))},HitDragging.prototype.prepareHits=function(){this.offsetTrackers=core.mapHash(this.droppableStore,function(interactionSettings){return interactionSettings.component.buildPositionCaches(),new OffsetTracker(interactionSettings.el)})},HitDragging.prototype.releaseHits=function(){var offsetTrackers=this.offsetTrackers;for(var id in offsetTrackers)offsetTrackers[id].destroy();this.offsetTrackers={}},HitDragging.prototype.queryHitForOffset=function(offsetLeft,offsetTop){var _a=this,droppableStore=_a.droppableStore,offsetTrackers=_a.offsetTrackers,bestHit=null;for(var id in droppableStore){var component=droppableStore[id].component,offsetTracker=offsetTrackers[id];if(offsetTracker.isWithinClipping(offsetLeft,offsetTop)){var originLeft=offsetTracker.computeLeft(),originTop=offsetTracker.computeTop(),positionLeft=offsetLeft-originLeft,positionTop=offsetTop-originTop,origRect=offsetTracker.origRect,width=origRect.right-origRect.left,height=origRect.bottom-origRect.top;if(positionLeft>=0&&width>positionLeft&&positionTop>=0&&height>positionTop){var hit=component.queryHit(positionLeft,positionTop,width,height);!hit||component.props.dateProfile&&!core.rangeContainsRange(component.props.dateProfile.activeRange,hit.dateSpan.range)||bestHit&&!(hit.layer>bestHit.layer)||(hit.rect.left+=originLeft,hit.rect.right+=originLeft,hit.rect.top+=originTop,hit.rect.bottom+=originTop,bestHit=hit)}}}return bestHit},HitDragging}(),DateClicking=function(_super){function DateClicking(settings){var _this=_super.call(this,settings)||this;_this.handlePointerDown=function(){var dragging=_this.dragging;dragging.setIgnoreMove(!_this.component.isValidDateDownEl(dragging.pointer.downEl))},_this.handleDragEnd=function(ev){var component=_this.component,_a=component.context,calendar=_a.calendar,view=_a.view,pointer=_this.dragging.pointer;if(!pointer.wasTouchScroll){var _b=_this.hitDragging,initialHit=_b.initialHit,finalHit=_b.finalHit;initialHit&&finalHit&&isHitsEqual(initialHit,finalHit)&&calendar.triggerDateClick(initialHit.dateSpan,initialHit.dayEl,view,ev.origEvent)}};var component=settings.component;_this.dragging=new FeaturefulElementDragging(component.el),_this.dragging.autoScroller.isEnabled=!1;var hitDragging=_this.hitDragging=new HitDragging(_this.dragging,core.interactionSettingsToStore(settings));return hitDragging.emitter.on("pointerdown",_this.handlePointerDown),hitDragging.emitter.on("dragend",_this.handleDragEnd),_this}return __extends(DateClicking,_super),DateClicking.prototype.destroy=function(){this.dragging.destroy()},DateClicking}(core.Interaction),DateSelecting=function(_super){function DateSelecting(settings){var _this=_super.call(this,settings)||this;_this.dragSelection=null,_this.handlePointerDown=function(ev){var _a=_this,component=_a.component,dragging=_a.dragging,options=component.context.options,canSelect=options.selectable&&component.isValidDateDownEl(ev.origEvent.target);dragging.setIgnoreMove(!canSelect),dragging.delay=ev.isTouch?getComponentTouchDelay(component):null},_this.handleDragStart=function(ev){_this.component.context.calendar.unselect(ev)},_this.handleHitUpdate=function(hit,isFinal){var calendar=_this.component.context.calendar,dragSelection=null,isInvalid=!1;hit&&(dragSelection=joinHitsIntoSelection(_this.hitDragging.initialHit,hit,calendar.pluginSystem.hooks.dateSelectionTransformers),dragSelection&&_this.component.isDateSelectionValid(dragSelection)||(isInvalid=!0,dragSelection=null)),dragSelection?calendar.dispatch({type:"SELECT_DATES",selection:dragSelection}):isFinal||calendar.dispatch({type:"UNSELECT_DATES"}),isInvalid?core.disableCursor():core.enableCursor(),isFinal||(_this.dragSelection=dragSelection)},_this.handlePointerUp=function(pev){_this.dragSelection&&(_this.component.context.calendar.triggerDateSelect(_this.dragSelection,pev),_this.dragSelection=null)};var component=settings.component,options=component.context.options,dragging=_this.dragging=new FeaturefulElementDragging(component.el);dragging.touchScrollAllowed=!1,dragging.minDistance=options.selectMinDistance||0,dragging.autoScroller.isEnabled=options.dragScroll;var hitDragging=_this.hitDragging=new HitDragging(_this.dragging,core.interactionSettingsToStore(settings));return hitDragging.emitter.on("pointerdown",_this.handlePointerDown),hitDragging.emitter.on("dragstart",_this.handleDragStart),hitDragging.emitter.on("hitupdate",_this.handleHitUpdate),hitDragging.emitter.on("pointerup",_this.handlePointerUp),_this}return __extends(DateSelecting,_super),DateSelecting.prototype.destroy=function(){this.dragging.destroy()},DateSelecting}(core.Interaction),EventDragging=function(_super){function EventDragging(settings){var _this=_super.call(this,settings)||this;_this.subjectSeg=null,_this.isDragging=!1,_this.eventRange=null,_this.relevantEvents=null,_this.receivingCalendar=null,_this.validMutation=null,_this.mutatedRelevantEvents=null,_this.handlePointerDown=function(ev){var origTarget=ev.origEvent.target,_a=_this,component=_a.component,dragging=_a.dragging,mirror=dragging.mirror,options=component.context.options,initialCalendar=component.context.calendar,subjectSeg=_this.subjectSeg=core.getElSeg(ev.subjectEl),eventRange=_this.eventRange=subjectSeg.eventRange,eventInstanceId=eventRange.instance.instanceId;_this.relevantEvents=core.getRelevantEvents(initialCalendar.state.eventStore,eventInstanceId),dragging.minDistance=ev.isTouch?0:options.eventDragMinDistance,dragging.delay=ev.isTouch&&eventInstanceId!==component.props.eventSelection?getComponentTouchDelay$1(component):null,mirror.parentNode=initialCalendar.el,mirror.revertDuration=options.dragRevertDuration;
var isValid=component.isValidSegDownEl(origTarget)&&!core.elementClosest(origTarget,".fc-resizer");dragging.setIgnoreMove(!isValid),_this.isDragging=isValid&&ev.subjectEl.classList.contains("fc-draggable")},_this.handleDragStart=function(ev){var context=_this.component.context,initialCalendar=context.calendar,eventRange=_this.eventRange,eventInstanceId=eventRange.instance.instanceId;ev.isTouch?eventInstanceId!==_this.component.props.eventSelection&&initialCalendar.dispatch({type:"SELECT_EVENT",eventInstanceId:eventInstanceId}):initialCalendar.dispatch({type:"UNSELECT_EVENT"}),_this.isDragging&&(initialCalendar.unselect(ev),initialCalendar.publiclyTrigger("eventDragStart",[{el:_this.subjectSeg.el,event:new core.EventApi(initialCalendar,eventRange.def,eventRange.instance),jsEvent:ev.origEvent,view:context.view}]))},_this.handleHitUpdate=function(hit,isFinal){if(_this.isDragging){var relevantEvents=_this.relevantEvents,initialHit=_this.hitDragging.initialHit,initialCalendar=_this.component.context.calendar,receivingCalendar=null,mutation=null,mutatedRelevantEvents=null,isInvalid=!1,interaction={affectedEvents:relevantEvents,mutatedEvents:core.createEmptyEventStore(),isEvent:!0,origSeg:_this.subjectSeg};if(hit){var receivingComponent=hit.component;receivingCalendar=receivingComponent.context.calendar;var receivingOptions=receivingComponent.context.options;initialCalendar===receivingCalendar||receivingOptions.editable&&receivingOptions.droppable?(mutation=computeEventMutation(initialHit,hit,receivingCalendar.pluginSystem.hooks.eventDragMutationMassagers),mutation&&(mutatedRelevantEvents=core.applyMutationToEventStore(relevantEvents,receivingCalendar.eventUiBases,mutation,receivingCalendar),interaction.mutatedEvents=mutatedRelevantEvents,receivingComponent.isInteractionValid(interaction)||(isInvalid=!0,mutation=null,mutatedRelevantEvents=null,interaction.mutatedEvents=core.createEmptyEventStore()))):receivingCalendar=null}_this.displayDrag(receivingCalendar,interaction),isInvalid?core.disableCursor():core.enableCursor(),isFinal||(initialCalendar===receivingCalendar&&isHitsEqual(initialHit,hit)&&(mutation=null),_this.dragging.setMirrorNeedsRevert(!mutation),_this.dragging.setMirrorIsVisible(!hit||!document.querySelector(".fc-mirror")),_this.receivingCalendar=receivingCalendar,_this.validMutation=mutation,_this.mutatedRelevantEvents=mutatedRelevantEvents)}},_this.handlePointerUp=function(){_this.isDragging||_this.cleanup()},_this.handleDragEnd=function(ev){if(_this.isDragging){var context=_this.component.context,initialCalendar_1=context.calendar,initialView=context.view,_a=_this,receivingCalendar=_a.receivingCalendar,validMutation=_a.validMutation,eventDef=_this.eventRange.def,eventInstance=_this.eventRange.instance,eventApi=new core.EventApi(initialCalendar_1,eventDef,eventInstance),relevantEvents_1=_this.relevantEvents,mutatedRelevantEvents=_this.mutatedRelevantEvents,finalHit=_this.hitDragging.finalHit;if(_this.clearDrag(),initialCalendar_1.publiclyTrigger("eventDragStop",[{el:_this.subjectSeg.el,event:eventApi,jsEvent:ev.origEvent,view:initialView}]),validMutation){if(receivingCalendar===initialCalendar_1){initialCalendar_1.dispatch({type:"MERGE_EVENTS",eventStore:mutatedRelevantEvents});for(var transformed={},_i=0,_b=initialCalendar_1.pluginSystem.hooks.eventDropTransformers;_i<_b.length;_i++){var transformer=_b[_i];__assign(transformed,transformer(validMutation,initialCalendar_1))}var eventDropArg=__assign({},transformed,{el:ev.subjectEl,delta:validMutation.datesDelta,oldEvent:eventApi,event:new core.EventApi(initialCalendar_1,mutatedRelevantEvents.defs[eventDef.defId],eventInstance?mutatedRelevantEvents.instances[eventInstance.instanceId]:null),revert:function(){initialCalendar_1.dispatch({type:"MERGE_EVENTS",eventStore:relevantEvents_1})},jsEvent:ev.origEvent,view:initialView});initialCalendar_1.publiclyTrigger("eventDrop",[eventDropArg])}else if(receivingCalendar){initialCalendar_1.publiclyTrigger("eventLeave",[{draggedEl:ev.subjectEl,event:eventApi,view:initialView}]),initialCalendar_1.dispatch({type:"REMOVE_EVENT_INSTANCES",instances:_this.mutatedRelevantEvents.instances}),receivingCalendar.dispatch({type:"MERGE_EVENTS",eventStore:_this.mutatedRelevantEvents}),ev.isTouch&&receivingCalendar.dispatch({type:"SELECT_EVENT",eventInstanceId:eventInstance.instanceId});var dropArg=__assign({},receivingCalendar.buildDatePointApi(finalHit.dateSpan),{draggedEl:ev.subjectEl,jsEvent:ev.origEvent,view:finalHit.component});receivingCalendar.publiclyTrigger("drop",[dropArg]),receivingCalendar.publiclyTrigger("eventReceive",[{draggedEl:ev.subjectEl,event:new core.EventApi(receivingCalendar,mutatedRelevantEvents.defs[eventDef.defId],mutatedRelevantEvents.instances[eventInstance.instanceId]),view:finalHit.component}])}}else initialCalendar_1.publiclyTrigger("_noEventDrop")}_this.cleanup()};var component=_this.component,options=component.context.options,dragging=_this.dragging=new FeaturefulElementDragging(component.el);dragging.pointer.selector=EventDragging.SELECTOR,dragging.touchScrollAllowed=!1,dragging.autoScroller.isEnabled=options.dragScroll;var hitDragging=_this.hitDragging=new HitDragging(_this.dragging,core.interactionSettingsStore);return hitDragging.useSubjectCenter=settings.useEventCenter,hitDragging.emitter.on("pointerdown",_this.handlePointerDown),hitDragging.emitter.on("dragstart",_this.handleDragStart),hitDragging.emitter.on("hitupdate",_this.handleHitUpdate),hitDragging.emitter.on("pointerup",_this.handlePointerUp),hitDragging.emitter.on("dragend",_this.handleDragEnd),_this}return __extends(EventDragging,_super),EventDragging.prototype.destroy=function(){this.dragging.destroy()},EventDragging.prototype.displayDrag=function(nextCalendar,state){var initialCalendar=this.component.context.calendar,prevCalendar=this.receivingCalendar;prevCalendar&&prevCalendar!==nextCalendar&&prevCalendar.dispatch(prevCalendar===initialCalendar?{type:"SET_EVENT_DRAG",state:{affectedEvents:state.affectedEvents,mutatedEvents:core.createEmptyEventStore(),isEvent:!0,origSeg:state.origSeg}}:{type:"UNSET_EVENT_DRAG"}),nextCalendar&&nextCalendar.dispatch({type:"SET_EVENT_DRAG",state:state})},EventDragging.prototype.clearDrag=function(){var initialCalendar=this.component.context.calendar,receivingCalendar=this.receivingCalendar;receivingCalendar&&receivingCalendar.dispatch({type:"UNSET_EVENT_DRAG"}),initialCalendar!==receivingCalendar&&initialCalendar.dispatch({type:"UNSET_EVENT_DRAG"})},EventDragging.prototype.cleanup=function(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingCalendar=null,this.validMutation=null,this.mutatedRelevantEvents=null},EventDragging.SELECTOR=".fc-draggable, .fc-resizable",EventDragging}(core.Interaction),EventDragging$1=function(_super){function EventDragging(settings){var _this=_super.call(this,settings)||this;_this.draggingSeg=null,_this.eventRange=null,_this.relevantEvents=null,_this.validMutation=null,_this.mutatedRelevantEvents=null,_this.handlePointerDown=function(ev){var component=_this.component,seg=_this.querySeg(ev),eventRange=_this.eventRange=seg.eventRange;_this.dragging.minDistance=component.context.options.eventDragMinDistance,_this.dragging.setIgnoreMove(!_this.component.isValidSegDownEl(ev.origEvent.target)||ev.isTouch&&_this.component.props.eventSelection!==eventRange.instance.instanceId)},_this.handleDragStart=function(ev){var _a=_this.component.context,calendar=_a.calendar,view=_a.view,eventRange=_this.eventRange;_this.relevantEvents=core.getRelevantEvents(calendar.state.eventStore,_this.eventRange.instance.instanceId),_this.draggingSeg=_this.querySeg(ev),calendar.unselect(),calendar.publiclyTrigger("eventResizeStart",[{el:_this.draggingSeg.el,event:new core.EventApi(calendar,eventRange.def,eventRange.instance),jsEvent:ev.origEvent,view:view}])},_this.handleHitUpdate=function(hit,isFinal,ev){var calendar=_this.component.context.calendar,relevantEvents=_this.relevantEvents,initialHit=_this.hitDragging.initialHit,eventInstance=_this.eventRange.instance,mutation=null,mutatedRelevantEvents=null,isInvalid=!1,interaction={affectedEvents:relevantEvents,mutatedEvents:core.createEmptyEventStore(),isEvent:!0,origSeg:_this.draggingSeg};hit&&(mutation=computeMutation(initialHit,hit,ev.subjectEl.classList.contains("fc-start-resizer"),eventInstance.range,calendar.pluginSystem.hooks.eventResizeJoinTransforms)),mutation&&(mutatedRelevantEvents=core.applyMutationToEventStore(relevantEvents,calendar.eventUiBases,mutation,calendar),interaction.mutatedEvents=mutatedRelevantEvents,_this.component.isInteractionValid(interaction)||(isInvalid=!0,mutation=null,mutatedRelevantEvents=null,interaction.mutatedEvents=null)),calendar.dispatch(mutatedRelevantEvents?{type:"SET_EVENT_RESIZE",state:interaction}:{type:"UNSET_EVENT_RESIZE"}),isInvalid?core.disableCursor():core.enableCursor(),isFinal||(mutation&&isHitsEqual(initialHit,hit)&&(mutation=null),_this.validMutation=mutation,_this.mutatedRelevantEvents=mutatedRelevantEvents)},_this.handleDragEnd=function(ev){var _a=_this.component.context,calendar=_a.calendar,view=_a.view,eventDef=_this.eventRange.def,eventInstance=_this.eventRange.instance,eventApi=new core.EventApi(calendar,eventDef,eventInstance),relevantEvents=_this.relevantEvents,mutatedRelevantEvents=_this.mutatedRelevantEvents;calendar.publiclyTrigger("eventResizeStop",[{el:_this.draggingSeg.el,event:eventApi,jsEvent:ev.origEvent,view:view}]),_this.validMutation?(calendar.dispatch({type:"MERGE_EVENTS",eventStore:mutatedRelevantEvents}),calendar.publiclyTrigger("eventResize",[{el:_this.draggingSeg.el,startDelta:_this.validMutation.startDelta||core.createDuration(0),endDelta:_this.validMutation.endDelta||core.createDuration(0),prevEvent:eventApi,event:new core.EventApi(calendar,mutatedRelevantEvents.defs[eventDef.defId],eventInstance?mutatedRelevantEvents.instances[eventInstance.instanceId]:null),revert:function(){calendar.dispatch({type:"MERGE_EVENTS",eventStore:relevantEvents})},jsEvent:ev.origEvent,view:view}])):calendar.publiclyTrigger("_noEventResize"),_this.draggingSeg=null,_this.relevantEvents=null,_this.validMutation=null};var component=settings.component,dragging=_this.dragging=new FeaturefulElementDragging(component.el);dragging.pointer.selector=".fc-resizer",dragging.touchScrollAllowed=!1,dragging.autoScroller.isEnabled=component.context.options.dragScroll;var hitDragging=_this.hitDragging=new HitDragging(_this.dragging,core.interactionSettingsToStore(settings));return hitDragging.emitter.on("pointerdown",_this.handlePointerDown),hitDragging.emitter.on("dragstart",_this.handleDragStart),hitDragging.emitter.on("hitupdate",_this.handleHitUpdate),hitDragging.emitter.on("dragend",_this.handleDragEnd),_this}return __extends(EventDragging,_super),EventDragging.prototype.destroy=function(){this.dragging.destroy()},EventDragging.prototype.querySeg=function(ev){return core.getElSeg(core.elementClosest(ev.subjectEl,this.component.fgSegSelector))},EventDragging}(core.Interaction),UnselectAuto=function(){function UnselectAuto(calendar){var _this=this;this.isRecentPointerDateSelect=!1,this.onSelect=function(selectInfo){selectInfo.jsEvent&&(_this.isRecentPointerDateSelect=!0)},this.onDocumentPointerUp=function(pev){var _a=_this,calendar=_a.calendar,documentPointer=_a.documentPointer,state=calendar.state;if(!documentPointer.wasTouchScroll){if(state.dateSelection&&!_this.isRecentPointerDateSelect){var unselectAuto=calendar.viewOpt("unselectAuto"),unselectCancel=calendar.viewOpt("unselectCancel");!unselectAuto||unselectAuto&&core.elementClosest(documentPointer.downEl,unselectCancel)||calendar.unselect(pev)}state.eventSelection&&!core.elementClosest(documentPointer.downEl,EventDragging.SELECTOR)&&calendar.dispatch({type:"UNSELECT_EVENT"})}_this.isRecentPointerDateSelect=!1},this.calendar=calendar;var documentPointer=this.documentPointer=new PointerDragging(document);documentPointer.shouldIgnoreMove=!0,documentPointer.shouldWatchScroll=!1,documentPointer.emitter.on("pointerup",this.onDocumentPointerUp),calendar.on("select",this.onSelect)}return UnselectAuto.prototype.destroy=function(){this.calendar.off("select",this.onSelect),this.documentPointer.destroy()},UnselectAuto}(),ExternalElementDragging=function(){function ExternalElementDragging(dragging,suppliedDragMeta){var _this=this;this.receivingCalendar=null,this.droppableEvent=null,this.suppliedDragMeta=null,this.dragMeta=null,this.handleDragStart=function(ev){_this.dragMeta=_this.buildDragMeta(ev.subjectEl)},this.handleHitUpdate=function(hit,isFinal,ev){var dragging=_this.hitDragging.dragging,receivingCalendar=null,droppableEvent=null,isInvalid=!1,interaction={affectedEvents:core.createEmptyEventStore(),mutatedEvents:core.createEmptyEventStore(),isEvent:_this.dragMeta.create,origSeg:null};hit&&(receivingCalendar=hit.component.context.calendar,_this.canDropElOnCalendar(ev.subjectEl,receivingCalendar)&&(droppableEvent=computeEventForDateSpan(hit.dateSpan,_this.dragMeta,receivingCalendar),interaction.mutatedEvents=core.eventTupleToStore(droppableEvent),isInvalid=!core.isInteractionValid(interaction,receivingCalendar),isInvalid&&(interaction.mutatedEvents=core.createEmptyEventStore(),droppableEvent=null))),_this.displayDrag(receivingCalendar,interaction),dragging.setMirrorIsVisible(isFinal||!droppableEvent||!document.querySelector(".fc-mirror")),isInvalid?core.disableCursor():core.enableCursor(),isFinal||(dragging.setMirrorNeedsRevert(!droppableEvent),_this.receivingCalendar=receivingCalendar,_this.droppableEvent=droppableEvent)},this.handleDragEnd=function(pev){var _a=_this,receivingCalendar=_a.receivingCalendar,droppableEvent=_a.droppableEvent;if(_this.clearDrag(),receivingCalendar&&droppableEvent){var finalHit=_this.hitDragging.finalHit,finalView=finalHit.component.context.view,dragMeta=_this.dragMeta,arg=__assign({},receivingCalendar.buildDatePointApi(finalHit.dateSpan),{draggedEl:pev.subjectEl,jsEvent:pev.origEvent,view:finalView});receivingCalendar.publiclyTrigger("drop",[arg]),dragMeta.create&&(receivingCalendar.dispatch({type:"MERGE_EVENTS",eventStore:core.eventTupleToStore(droppableEvent)}),pev.isTouch&&receivingCalendar.dispatch({type:"SELECT_EVENT",eventInstanceId:droppableEvent.instance.instanceId}),receivingCalendar.publiclyTrigger("eventReceive",[{draggedEl:pev.subjectEl,event:new core.EventApi(receivingCalendar,droppableEvent.def,droppableEvent.instance),view:finalView}]))}_this.receivingCalendar=null,_this.droppableEvent=null};var hitDragging=this.hitDragging=new HitDragging(dragging,core.interactionSettingsStore);hitDragging.requireInitial=!1,hitDragging.emitter.on("dragstart",this.handleDragStart),hitDragging.emitter.on("hitupdate",this.handleHitUpdate),hitDragging.emitter.on("dragend",this.handleDragEnd),this.suppliedDragMeta=suppliedDragMeta}return ExternalElementDragging.prototype.buildDragMeta=function(subjectEl){return"object"==typeof this.suppliedDragMeta?core.parseDragMeta(this.suppliedDragMeta):"function"==typeof this.suppliedDragMeta?core.parseDragMeta(this.suppliedDragMeta(subjectEl)):getDragMetaFromEl(subjectEl)},ExternalElementDragging.prototype.displayDrag=function(nextCalendar,state){var prevCalendar=this.receivingCalendar;prevCalendar&&prevCalendar!==nextCalendar&&prevCalendar.dispatch({type:"UNSET_EVENT_DRAG"}),nextCalendar&&nextCalendar.dispatch({type:"SET_EVENT_DRAG",state:state})},ExternalElementDragging.prototype.clearDrag=function(){this.receivingCalendar&&this.receivingCalendar.dispatch({type:"UNSET_EVENT_DRAG"})},ExternalElementDragging.prototype.canDropElOnCalendar=function(el,receivingCalendar){var dropAccept=receivingCalendar.opt("dropAccept");return"function"==typeof dropAccept?dropAccept(el):"string"==typeof dropAccept&&dropAccept?Boolean(core.elementMatches(el,dropAccept)):!0},ExternalElementDragging}();core.config.dataAttrPrefix="";var ExternalDraggable=function(){function ExternalDraggable(el,settings){var _this=this;void 0===settings&&(settings={}),this.handlePointerDown=function(ev){var dragging=_this.dragging,_a=_this.settings,minDistance=_a.minDistance,longPressDelay=_a.longPressDelay;dragging.minDistance=null!=minDistance?minDistance:ev.isTouch?0:core.globalDefaults.eventDragMinDistance,dragging.delay=ev.isTouch?null!=longPressDelay?longPressDelay:core.globalDefaults.longPressDelay:0},this.handleDragStart=function(ev){ev.isTouch&&_this.dragging.delay&&ev.subjectEl.classList.contains("fc-event")&&_this.dragging.mirror.getMirrorEl().classList.add("fc-selected")},this.settings=settings;var dragging=this.dragging=new FeaturefulElementDragging(el);dragging.touchScrollAllowed=!1,null!=settings.itemSelector&&(dragging.pointer.selector=settings.itemSelector),null!=settings.appendTo&&(dragging.mirror.parentNode=settings.appendTo),dragging.emitter.on("pointerdown",this.handlePointerDown),dragging.emitter.on("dragstart",this.handleDragStart),new ExternalElementDragging(dragging,settings.eventData)}return ExternalDraggable.prototype.destroy=function(){this.dragging.destroy()},ExternalDraggable}(),InferredElementDragging=function(_super){function InferredElementDragging(containerEl){var _this=_super.call(this,containerEl)||this;_this.shouldIgnoreMove=!1,_this.mirrorSelector="",_this.currentMirrorEl=null,_this.handlePointerDown=function(ev){_this.emitter.trigger("pointerdown",ev),_this.shouldIgnoreMove||_this.emitter.trigger("dragstart",ev)},_this.handlePointerMove=function(ev){_this.shouldIgnoreMove||_this.emitter.trigger("dragmove",ev)},_this.handlePointerUp=function(ev){_this.emitter.trigger("pointerup",ev),_this.shouldIgnoreMove||_this.emitter.trigger("dragend",ev)};var pointer=_this.pointer=new PointerDragging(containerEl);return pointer.emitter.on("pointerdown",_this.handlePointerDown),pointer.emitter.on("pointermove",_this.handlePointerMove),pointer.emitter.on("pointerup",_this.handlePointerUp),_this}return __extends(InferredElementDragging,_super),InferredElementDragging.prototype.destroy=function(){this.pointer.destroy()},InferredElementDragging.prototype.setIgnoreMove=function(bool){this.shouldIgnoreMove=bool},InferredElementDragging.prototype.setMirrorIsVisible=function(bool){if(bool)this.currentMirrorEl&&(this.currentMirrorEl.style.visibility="",this.currentMirrorEl=null);else{var mirrorEl=this.mirrorSelector?document.querySelector(this.mirrorSelector):null;mirrorEl&&(this.currentMirrorEl=mirrorEl,mirrorEl.style.visibility="hidden")}},InferredElementDragging}(core.ElementDragging),ThirdPartyDraggable=function(){function ThirdPartyDraggable(containerOrSettings,settings){var containerEl=document;containerOrSettings===document||containerOrSettings instanceof Element?(containerEl=containerOrSettings,settings=settings||{}):settings=containerOrSettings||{};var dragging=this.dragging=new InferredElementDragging(containerEl);"string"==typeof settings.itemSelector?dragging.pointer.selector=settings.itemSelector:containerEl===document&&(dragging.pointer.selector="[data-event]"),"string"==typeof settings.mirrorSelector&&(dragging.mirrorSelector=settings.mirrorSelector),new ExternalElementDragging(dragging,settings.eventData)}return ThirdPartyDraggable.prototype.destroy=function(){this.dragging.destroy()},ThirdPartyDraggable}(),main=core.createPlugin({componentInteractions:[DateClicking,DateSelecting,EventDragging,EventDragging$1],calendarInteractions:[UnselectAuto],elementDraggingImpl:FeaturefulElementDragging});exports.Draggable=ExternalDraggable,exports.FeaturefulElementDragging=FeaturefulElementDragging,exports.PointerDragging=PointerDragging,exports.ThirdPartyDraggable=ThirdPartyDraggable,exports.default=main,Object.defineProperty(exports,"__esModule",{value:!0})});