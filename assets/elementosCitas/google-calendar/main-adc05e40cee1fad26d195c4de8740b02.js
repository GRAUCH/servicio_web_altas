!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@fullcalendar/core")):"function"==typeof define&&define.amd?define(["exports","@fullcalendar/core"],factory):(global=global||self,factory(global.FullCalendarGoogleCalendar={},global.FullCalendar))}(this,function(exports,core){"use strict";function parseGoogleCalendarId(url){var match;return/^[^\/]+@([^\/\.]+\.)*(google|googlemail|gmail)\.com$/.test(url)?url:(match=/^https:\/\/www.googleapis.com\/calendar\/v3\/calendars\/([^\/]*)/.exec(url))||(match=/^https?:\/\/www.google.com\/calendar\/feeds\/([^\/]*)/.exec(url))?decodeURIComponent(match[1]):void 0}function buildUrl(meta){var apiBase=meta.googleCalendarApiBase;return apiBase||(apiBase=API_BASE),apiBase+"/"+encodeURIComponent(meta.googleCalendarId)+"/events"}function buildRequestParams(range,apiKey,extraParams,dateEnv){var params,startStr,endStr;return dateEnv.canComputeOffset?(startStr=dateEnv.formatIso(range.start),endStr=dateEnv.formatIso(range.end)):(startStr=core.addDays(range.start,-1).toISOString(),endStr=core.addDays(range.end,1).toISOString()),params=__assign({},extraParams||{},{key:apiKey,timeMin:startStr,timeMax:endStr,singleEvents:!0,maxResults:9999}),"local"!==dateEnv.timeZone&&(params.timeZone=dateEnv.timeZone),params}function gcalItemsToRawEventDefs(items,gcalTimezone){return items.map(function(item){return gcalItemToRawEventDef(item,gcalTimezone)})}function gcalItemToRawEventDef(item,gcalTimezone){var url=item.htmlLink||null;return url&&gcalTimezone&&(url=injectQsComponent(url,"ctz="+gcalTimezone)),{id:item.id,title:item.summary,start:item.start.dateTime||item.start.date,end:item.end.dateTime||item.end.date,url:url,location:item.location,description:item.description}}function injectQsComponent(url,component){return url.replace(/(\?.*?)?(#|$)/,function(whole,qs,hash){return(qs?qs+"&":"?")+component+hash})}var __assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;n>i;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__assign.apply(this,arguments)},API_BASE="https://www.googleapis.com/calendar/v3/calendars",STANDARD_PROPS={url:String,googleCalendarApiKey:String,googleCalendarId:String,googleCalendarApiBase:String,data:null},eventSourceDef={parseMeta:function(raw){if("string"==typeof raw&&(raw={url:raw}),"object"==typeof raw){var standardProps=core.refineProps(raw,STANDARD_PROPS);if(!standardProps.googleCalendarId&&standardProps.url&&(standardProps.googleCalendarId=parseGoogleCalendarId(standardProps.url)),delete standardProps.url,standardProps.googleCalendarId)return standardProps}return null},fetch:function(arg,onSuccess,onFailure){var calendar=arg.calendar,meta=arg.eventSource.meta,apiKey=meta.googleCalendarApiKey||calendar.opt("googleCalendarApiKey");if(apiKey){var url=buildUrl(meta),requestParams_1=buildRequestParams(arg.range,apiKey,meta.data,calendar.dateEnv);core.requestJson("GET",url,requestParams_1,function(body,xhr){body.error?onFailure({message:"Google Calendar API: "+body.error.message,errors:body.error.errors,xhr:xhr}):onSuccess({rawEvents:gcalItemsToRawEventDefs(body.items,requestParams_1.timeZone),xhr:xhr})},function(message,xhr){onFailure({message:message,xhr:xhr})})}else onFailure({message:"Specify a googleCalendarApiKey. See http://fullcalendar.io/docs/google_calendar/"})}},main=core.createPlugin({eventSourceDefs:[eventSourceDef]});exports.default=main,Object.defineProperty(exports,"__esModule",{value:!0})});