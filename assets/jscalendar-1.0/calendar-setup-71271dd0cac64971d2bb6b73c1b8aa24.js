CalendarSetup=function(params){function param_default(pname,def){"undefined"==typeof params[pname]&&(params[pname]=def)}function onSelect(cal){var p=cal.params,update=cal.dateClicked||p.electric;update&&p.inputField&&(p.inputField.value=cal.date.print(p.ifFormat),"function"==typeof p.inputField.onchange&&p.inputField.onchange()),update&&p.displayArea&&(p.displayArea.innerHTML=cal.date.print(p.daFormat)),update&&"function"==typeof p.onUpdate&&p.onUpdate(cal),update&&p.flat&&"function"==typeof p.flatCallback&&p.flatCallback(cal),update&&p.singleClick&&cal.dateClicked&&cal.callCloseHandler()}param_default("inputField",null),param_default("displayArea",null),param_default("button",null),param_default("eventName","click"),param_default("ifFormat","%Y/%m/%d"),param_default("daFormat","%Y/%m/%d"),param_default("singleClick",!0),param_default("disableFunc",null),param_default("dateStatusFunc",params.disableFunc),param_default("dateText",null),param_default("firstDay",null),param_default("align","Br"),param_default("range",[1900,2999]),param_default("weekNumbers",!0),param_default("flat",null),param_default("flatCallback",null),param_default("onSelect",null),param_default("onClose",null),param_default("onUpdate",null),param_default("date",null),param_default("showsTime",!1),param_default("timeFormat","24"),param_default("electric",!0),param_default("step",2),param_default("position",null),param_default("cache",!1),param_default("showOthers",!1),param_default("multiple",null);var tmp=["inputField","displayArea","button"];for(var i in tmp)"string"==typeof params[tmp[i]]&&(params[tmp[i]]=document.getElementById(params[tmp[i]]));if(!(params.flat||params.multiple||params.inputField||params.displayArea||params.button))return alert("CalendarSetup:\n  Nothing to setup (no fields found).  Please check your code"),!1;if(null!=params.flat){if("string"==typeof params.flat&&(params.flat=document.getElementById(params.flat)),!params.flat)return alert("CalendarSetup:\n  Flat specified but can't find parent."),!1;var cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect);return cal.showsOtherMonths=params.showOthers,cal.showsTime=params.showsTime,cal.time24="24"==params.timeFormat,cal.params=params,cal.weekNumbers=params.weekNumbers,cal.setRange(params.range[0],params.range[1]),cal.setDateStatusHandler(params.dateStatusFunc),cal.getDateText=params.dateText,params.ifFormat&&cal.setDateFormat(params.ifFormat),params.inputField&&"string"==typeof params.inputField.value&&cal.parseDate(params.inputField.value),cal.create(params.flat),cal.show(),!1}var triggerEl=params.button||params.displayArea||params.inputField;return triggerEl["on"+params.eventName]=function(){var dateEl=params.inputField||params.displayArea,dateFmt=params.inputField?params.ifFormat:params.daFormat,mustCreate=!1,cal=window.calendar;if(dateEl&&(params.date=Date.parseDate(dateEl.value||dateEl.innerHTML,dateFmt)),cal&&params.cache?(params.date&&cal.setDate(params.date),cal.hide()):(window.calendar=cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect,params.onClose||function(cal){cal.hide()}),cal.showsTime=params.showsTime,cal.time24="24"==params.timeFormat,cal.weekNumbers=params.weekNumbers,mustCreate=!0),params.multiple){cal.multiple={};for(var i=params.multiple.length;--i>=0;){var d=params.multiple[i],ds=d.print("%Y%m%d");cal.multiple[ds]=d}}return cal.showsOtherMonths=params.showOthers,cal.yearStep=params.step,cal.setRange(params.range[0],params.range[1]),cal.params=params,cal.setDateStatusHandler(params.dateStatusFunc),cal.getDateText=params.dateText,cal.setDateFormat(dateFmt),mustCreate&&cal.create(),cal.refresh(),params.position?cal.showAt(params.position[0],params.position[1]):cal.showAtElement(params.button||params.displayArea||params.inputField,params.align),!1},cal};